<!DOCTYPE html>
<html lang="en">
    <head>
        {{> main}}
        <title>Add New Retreat</title>
    </head>
    <body>
        <div class="container">
            <h2 class="page-title">Add a New Retreat</h2>

            <form class="new-retreat-form" id="new-retreat-form" action="/new-retreat" method="POST">
                <!-- Retreat Name -->
                <div class="form-group">
                    <label for="retreat_name">Retreat Name</label>
                    <input type="text" id="retreat_name" name="retreat_name" placeholder="Enter retreat name" required>
                </div>

                <!-- Start Date -->
                <div class="form-group">
                    <label for="start_date">Start Date</label>
                    <input type="date" id="start_date" name="start_date" required>
                </div>

                <!-- Length -->
                <div class="form-group">
                    <label for="length">Length (in days)</label>
                    <input type="number" id="length" name="length" min="1" placeholder="Enter retreat length" required>
                </div>

                <!-- Meal Options -->
                <div class="form-group">
                    <label for="meal_options_input">Meal Options</label>
                    <input type="text" id="meal_options_input" name="meal_options_input" placeholder="Enter meal options separated by commas" required>
                    <input type="hidden" id="meal_options_json" name="meal_options_json">
                </div>

                <!-- Room Types -->
                <div class="form-group">
                    <label>Room Types</label>
                    <div id="room-types-container">
                        <!-- Dynamic room type fields will be added here -->
                    </div>
                    <button type="button" id="add-room-type" class="btn">Add Room Type</button>
                </div>

                <!-- Submit Button -->
                <div class="form-group">
                    <input type="submit" value="Submit" class="btn btn-primary">
                </div>
            </form>
        </div>
        {{> footer}}
    </body>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('new-retreat-form');
            const mealOptionsInput = document.getElementById('meal_options_input');
            const mealOptionsJson = document.getElementById('meal_options_json');

            form.addEventListener('submit', (event) => {
                // Convert the text input into a JSON array
                const mealOptionsArray = mealOptionsInput.value.split(',').map(option => option.trim());
                mealOptionsJson.value = JSON.stringify(mealOptionsArray);

                console.log("Meal Options JSON:", mealOptionsJson.value); // For debugging
            });
        });

        document.addEventListener('DOMContentLoaded', () => {
            const roomTypesContainer = document.getElementById('room-types-container');
            const addRoomTypeButton = document.getElementById('add-room-type');

            // Function to create a new room type input group
            function createRoomTypeFields(index) {
                const roomTypeDiv = document.createElement('div');
                roomTypeDiv.classList.add('room-type');

                roomTypeDiv.innerHTML = `
                    <div>
                        <label>Room Name:</label>
                        <input type="text" name="room_types[${index}][room_name]" placeholder="Enter room name" required>
                    </div>
                    <div>
                        <label>Room Price:</label>
                        <input type="number" name="room_types[${index}][price]" min="0" step="0.01" placeholder="Enter room price" required>
                    </div>
                    <div>
                        <label>Capacity:</label>
                        <input type="number" name="room_types[${index}][capacity]" min="1" placeholder="Enter room capacity" required>
                    </div>
                    <div>
                        <label>Inventory:</label>
                        <input type="number" name="room_types[${index}][inventory]" min="0" placeholder="Enter room inventory" required>
                    </div>
                    <button type="button" class="remove-room-type btn btn-delete">Remove</button>
                `;

                // Add event listener to remove button
                roomTypeDiv.querySelector('.remove-room-type').addEventListener('click', () => {
                    roomTypeDiv.remove();
                });

                return roomTypeDiv;
            }

            // Add a new room type when the button is clicked
            addRoomTypeButton.addEventListener('click', () => {
                const index = roomTypesContainer.children.length; // Use the current count as the index
                const newRoomType = createRoomTypeFields(index);
                roomTypesContainer.appendChild(newRoomType);
            });
        });
    </script>
</html>